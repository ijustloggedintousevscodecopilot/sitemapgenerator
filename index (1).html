<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Sitemap Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        .url-item {
            transition: all 0.3s ease;
        }
        .url-item:hover {
            background-color: #f3f4f6;
        }
        .valid-url {
            border-left: 4px solid #10b981;
        }
        .invalid-url {
            border-left: 4px solid #ef4444;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Local Sitemap Generator</h1>
            <p class="text-lg text-gray-600">Generate XML sitemaps and robots.txt from your URL list</p>
        </div>

        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">URL Input</h2>
            
            <!-- Input Method Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Choose input method:</label>
                <div class="flex space-x-4">
                    <label class="flex items-center">
                        <input type="radio" name="inputMethod" value="text" checked class="mr-2">
                        <span class="text-sm">Paste URLs</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="inputMethod" value="file" class="mr-2">
                        <span class="text-sm">Upload File</span>
                    </label>
                </div>
            </div>

            <!-- Text Input -->
            <div id="textInput" class="mb-4">
                <label for="urlList" class="block text-sm font-medium text-gray-700 mb-2">
                    Paste your URLs (one per line) or folder structure:
                </label>
                <textarea 
                    id="urlList" 
                    class="w-full h-40 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Example:
https://example.com/
https://example.com/about
https://example.com/contact
https://example.com/products/page1.html"
                ></textarea>
                <p class="text-xs text-gray-500 mt-1">Tips: One URL per line, or paste folder structure like "about/team.html"</p>
            </div>

            <!-- File Upload -->
            <div id="fileInput" class="mb-4 hidden">
                <label for="fileUpload" class="block text-sm font-medium text-gray-700 mb-2">
                    Upload a text file containing URLs:
                </label>
                <input 
                    type="file" 
                    id="fileUpload" 
                    accept=".txt,.csv"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-xs text-gray-500 mt-1">Supported formats: .txt, .csv (one URL per line)</p>
            </div>

            <!-- Base URL -->
            <div class="mb-4">
                <label for="baseUrl" class="block text-sm font-medium text-gray-700 mb-2">
                    Base URL (optional - will be prepended to relative URLs):
                </label>
                <input 
                    type="url" 
                    id="baseUrl" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="https://example.com"
                >
            </div>

            <!-- Parse Button -->
            <button 
                id="parseBtn" 
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium"
            >
                Parse URLs
            </button>
        </div>

        <!-- URL Processing Progress -->
        <div id="processingSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <h3 class="text-lg font-semibold mb-3">Processing URLs</h3>
            <div class="mb-3">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                    <span>Progress</span>
                    <span id="progressText">0/0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                </div>
            </div>
            <div id="processingStatus" class="text-sm text-gray-600"></div>
        </div>

        <!-- URL List Section -->
        <div id="urlListSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Valid URLs</h3>
                <div class="flex space-x-2">
                    <button id="validateBtn" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                        Validate All
                    </button>
                    <button id="clearBtn" class="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600">
                        Clear All
                    </button>
                </div>
            </div>
            <div id="urlList" class="space-y-2 max-h-60 overflow-y-auto"></div>
            <div class="mt-4 text-sm text-gray-600">
                <span id="validCount">0</span> valid URLs, <span id="invalidCount">0</span> invalid URLs
            </div>
        </div>

        <!-- Configuration Section -->
        <div id="configSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <h3 class="text-lg font-semibold mb-4">Sitemap Configuration</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="defaultPriority" class="block text-sm font-medium text-gray-700 mb-2">
                        Default Priority (0.0-1.0):
                    </label>
                    <input 
                        type="number" 
                        id="defaultPriority" 
                        min="0" 
                        max="1" 
                        step="0.1" 
                        value="0.5"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                </div>
                
                <div>
                    <label for="defaultChangefreq" class="block text-sm font-medium text-gray-700 mb-2">
                        Default Change Frequency:
                    </label>
                    <select id="defaultChangefreq" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                        <option value="never">Never</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label for="lastmodDate" class="block text-sm font-medium text-gray-700 mb-2">
                    Last Modified Date:
                </label>
                <input 
                    type="date" 
                    id="lastmodDate" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-xs text-gray-500 mt-1">Leave empty to use today's date for all URLs</p>
            </div>

            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" id="autoPriority" class="mr-2" checked>
                    <span class="text-sm">Auto-generate priorities based on URL depth</span>
                </label>
            </div>
        </div>

        <!-- Generation Section -->
        <div id="generationSection" class="bg-white rounded-lg shadow-lg p-6 hidden">
            <h3 class="text-lg font-semibold mb-4">Generate Files</h3>
            
            <div class="flex flex-wrap gap-3">
                <button 
                    id="generateSitemap" 
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium"
                >
                    Generate XML Sitemap
                </button>
                
                <button 
                    id="generateRobots" 
                    class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 font-medium"
                >
                    Generate Robots.txt
                </button>
                
                <button 
                    id="downloadAll" 
                    class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 font-medium"
                >
                    Download Both
                </button>
            </div>

            <!-- Preview Section -->
            <div id="previewSection" class="mt-6 hidden">
                <h4 class="text-md font-semibold mb-2">Preview:</h4>
                <div class="bg-gray-100 p-3 rounded-md max-h-60 overflow-y-auto">
                    <pre id="previewContent" class="text-sm text-gray-800 whitespace-pre-wrap"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SitemapGenerator {
            constructor() {
                this.urls = [];
                this.validUrls = [];
                this.invalidUrls = [];
                this.init();
            }

            init() {
                this.bindEvents();
                this.setDefaultDate();
            }

            bindEvents() {
                // Input method toggle
                document.querySelectorAll('input[name="inputMethod"]').forEach(radio => {
                    radio.addEventListener('change', this.toggleInputMethod);
                });

                // Parse button
                document.getElementById('parseBtn').addEventListener('click', () => this.parseUrls());
                
                // File upload
                document.getElementById('fileUpload').addEventListener('change', (e) => this.handleFileUpload(e));
                
                // URL management
                document.getElementById('validateBtn').addEventListener('click', () => this.validateAllUrls());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearUrls());
                
                // Generation
                document.getElementById('generateSitemap').addEventListener('click', () => this.generateSitemap());
                document.getElementById('generateRobots').addEventListener('click', () => this.generateRobots());
                document.getElementById('downloadAll').addEventListener('click', () => this.downloadAll());
            }

            toggleInputMethod(e) {
                const textInput = document.getElementById('textInput');
                const fileInput = document.getElementById('fileInput');
                
                if (e.target.value === 'text') {
                    textInput.classList.remove('hidden');
                    fileInput.classList.add('hidden');
                } else {
                    textInput.classList.add('hidden');
                    fileInput.classList.remove('hidden');
                }
            }

            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('lastmodDate').value = today;
            }

            async parseUrls() {
                const inputMethod = document.querySelector('input[name="inputMethod"]:checked').value;
                let urls = [];

                if (inputMethod === 'text') {
                    const textInput = document.getElementById('urlList').value;
                    urls = textInput.split('\n').map(url => url.trim()).filter(url => url);
                } else {
                    // File upload method would be handled in handleFileUpload
                    return;
                }

                if (urls.length === 0) {
                    alert('Please enter at least one URL');
                    return;
                }

                this.urls = urls;
                await this.processUrls();
            }

            async handleFileUpload(e) {
                const file = e.target.files[0];
                if (!file) return;

                const text = await file.text();
                const urls = text.split('\n').map(url => url.trim()).filter(url => url);
                
                if (urls.length === 0) {
                    alert('The file appears to be empty or contains no valid URLs');
                    return;
                }

                this.urls = urls;
                await this.processUrls();
            }

            async processUrls() {
                document.getElementById('processingSection').classList.remove('hidden');
                this.updateProgress(0, this.urls.length, 'Processing URLs...');
                
                this.validUrls = [];
                this.invalidUrls = [];
                
                for (let i = 0; i < this.urls.length; i++) {
                    const url = this.urls[i];
                    const processedUrl = this.processUrl(url);
                    
                    if (processedUrl) {
                        this.validUrls.push(processedUrl);
                    } else {
                        this.invalidUrls.push(url);
                    }
                    
                    this.updateProgress(i + 1, this.urls.length, `Processed ${i + 1} of ${this.urls.length} URLs`);
                    
                    // Small delay to prevent UI blocking
                    if (i % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }

                this.displayUrlList();
                document.getElementById('configSection').classList.remove('hidden');
                document.getElementById('generationSection').classList.remove('hidden');
            }

            processUrl(url) {
                const baseUrl = document.getElementById('baseUrl').value.trim();
                let processedUrl = url;

                // Handle relative URLs
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    if (baseUrl) {
                        processedUrl = baseUrl.replace(/\/$/, '') + '/' + url.replace(/^\//, '');
                    } else {
                        // Assume it's a file path, convert to file:// URL
                        processedUrl = 'file://' + url;
                    }
                }

                try {
                    new URL(processedUrl);
                    return processedUrl;
                } catch {
                    return null;
                }
            }

            updateProgress(current, total, status) {
                const percentage = (current / total) * 100;
                document.getElementById('progressBar').style.width = percentage + '%';
                document.getElementById('progressText').textContent = `${current}/${total}`;
                document.getElementById('processingStatus').textContent = status;
            }

            displayUrlList() {
                const urlList = document.getElementById('urlList');
                urlList.innerHTML = '';

                this.validUrls.forEach((url, index) => {
                    const urlElement = this.createUrlElement(url, index, true);
                    urlList.appendChild(urlElement);
                });

                this.invalidUrls.forEach((url, index) => {
                    const urlElement = this.createUrlElement(url, index, false);
                    urlList.appendChild(urlElement);
                });

                document.getElementById('validCount').textContent = this.validUrls.length;
                document.getElementById('invalidCount').textContent = this.invalidUrls.length;
                document.getElementById('urlListSection').classList.remove('hidden');
            }

            createUrlElement(url, index, isValid) {
                const div = document.createElement('div');
                div.className = `url-item p-3 rounded-md border-l-4 ${
                    isValid ? 'valid-url bg-green-50' : 'invalid-url bg-red-50'
                }`;
                
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium ${isValid ? 'text-green-800' : 'text-red-800'} truncate flex-1 mr-2">
                            ${url}
                        </span>
                        <button onclick="sitemapGenerator.removeUrl('${url}', ${isValid})" 
                                class="text-red-500 hover:text-red-700 text-xs">
                            Remove
                        </button>
                    </div>
                `;
                
                return div;
            }

            async validateAllUrls() {
                const validateBtn = document.getElementById('validateBtn');
                validateBtn.textContent = 'Validating...';
                validateBtn.disabled = true;

                for (let i = 0; i < this.validUrls.length; i++) {
                    const url = this.validUrls[i];
                    const isValid = await this.validateUrl(url);
                    
                    if (!isValid) {
                        // Move to invalid list
                        this.invalidUrls.push(url);
                        this.validUrls = this.validUrls.filter(u => u !== url);
                    }
                    
                    this.updateProgress(i + 1, this.validUrls.length, `Validated ${i + 1} of ${this.validUrls.length} URLs`);
                    
                    if (i % 5 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 10));
                    }
                }

                this.displayUrlList();
                validateBtn.textContent = 'Validate All';
                validateBtn.disabled = false;
            }

            async validateUrl(url) {
                try {
                    // Simple URL syntax validation
                    new URL(url);
                    return true;
                } catch {
                    return false;
                }
            }

            removeUrl(url, isValid) {
                if (isValid) {
                    this.validUrls = this.validUrls.filter(u => u !== url);
                } else {
                    this.invalidUrls = this.invalidUrls.filter(u => u !== url);
                }
                this.displayUrlList();
            }

            clearUrls() {
                this.urls = [];
                this.validUrls = [];
                this.invalidUrls = [];
                document.getElementById('urlListSection').classList.add('hidden');
                document.getElementById('configSection').classList.add('hidden');
                document.getElementById('generationSection').classList.add('hidden');
                document.getElementById('urlList').value = '';
                document.getElementById('fileUpload').value = '';
            }

            generateSitemap() {
                if (this.validUrls.length === 0) {
                    alert('No valid URLs to generate sitemap');
                    return;
                }

                const defaultPriority = parseFloat(document.getElementById('defaultPriority').value);
                const defaultChangefreq = document.getElementById('defaultChangefreq').value;
                const lastmodDate = document.getElementById('lastmodDate').value || new Date().toISOString().split('T')[0];
                const autoPriority = document.getElementById('autoPriority').checked;

                let sitemap = `<?xml version="1.0" encoding="UTF-8"?>\n`;
                sitemap += `<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n`;

                this.validUrls.forEach(url => {
                    const priority = autoPriority ? this.calculatePriority(url) : defaultPriority;
                    
                    sitemap += `  <url>\n`;
                    sitemap += `    <loc>${this.escapeXml(url)}</loc>\n`;
                    sitemap += `    <lastmod>${lastmodDate}</lastmod>\n`;
                    sitemap += `    <changefreq>${defaultChangefreq}</changefreq>\n`;
                    sitemap += `    <priority>${priority.toFixed(1)}</priority>\n`;
                    sitemap += `  </url>\n`;
                });

                sitemap += `</urlset>`;

                this.showPreview(sitemap);
                this.downloadFile(sitemap, 'sitemap.xml', 'text/xml');
            }

            generateRobots() {
                if (this.validUrls.length === 0) {
                    alert('No valid URLs to generate robots.txt');
                    return;
                }

                // Extract base domain from first URL
                const firstUrl = this.validUrls[0];
                let robotsContent = `User-agent: *\n`;
                robotsContent += `Allow: /\n\n`;
                
                // Add sitemap reference
                robotsContent += `# Sitemap reference\n`;
                robotsContent += `Sitemap: ${firstUrl.replace(/\/[^\/]*$/, '/sitemap.xml')}\n`;

                // Add common disallow rules for static sites
                robotsContent += `\n# Common directories to disallow\n`;
                robotsContent += `Disallow: /admin/\n`;
                robotsContent += `Disallow: /private/\n`;
                robotsContent += `Disallow: /.git/\n`;

                this.showPreview(robotsContent);
                this.downloadFile(robotsContent, 'robots.txt', 'text/plain');
            }

            async downloadAll() {
                if (this.validUrls.length === 0) {
                    alert('No valid URLs to generate files');
                    return;
                }

                // Generate and download sitemap
                this.generateSitemap();
                
                // Small delay, then generate robots
                setTimeout(() => {
                    this.generateRobots();
                }, 500);
            }

            calculatePriority(url) {
                // Simple algorithm: homepage gets 1.0, root pages get 0.8, subdirectories get lower priorities
                const pathLength = new URL(url).pathname.split('/').filter(p => p).length;
                const priority = Math.max(0.1, 1.0 - (pathLength * 0.2));
                return Math.min(1.0, priority);
            }

            escapeXml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showPreview(content) {
                const previewSection = document.getElementById('previewSection');
                const previewContent = document.getElementById('previewContent');
                
                previewContent.textContent = content;
                previewSection.classList.remove('hidden');
            }

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
            }
        }

        // Initialize the application
        let sitemapGenerator;
        document.addEventListener('DOMContentLoaded', () => {
            sitemapGenerator = new SitemapGenerator();
        });
    </script>
</body>
</html>